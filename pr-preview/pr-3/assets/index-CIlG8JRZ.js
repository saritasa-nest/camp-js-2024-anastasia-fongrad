var _=Object.defineProperty;var g=(c,t,e)=>t in c?_(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var n=(c,t,e)=>g(c,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const P=2,S=6;class y{constructor(){n(this,"subscribers");this.subscribers=new Set}subscribe(t){this.subscribers.add(t)}unsubscribe(t){this.subscribers.has(t)&&this.subscribers.delete(t)}notify(t){this.subscribers.forEach(e=>{e.update(t)})}}const d=class d extends y{constructor(){super();n(this,"sidesCount");this.sidesCount=S,o.getInstance().subscribe(this)}update(e){const r={playerId:e,diceResult:this.generateDiceNumber()};this.notify(r)}notify(e){if(this.subscribers.size===0)return;let{playerId:r}=e,s;const i=l=>l.getId()===r;for(;s==null;)s=Array.from(this.subscribers).find(i),r++;s.update(e)}static getInstance(){return this.instance||(this.instance=new d),this.instance}generateDiceNumber(){return Math.floor(Math.random()*this.sidesCount)+1}getPlayersNumber(){return this.subscribers.size}};n(d,"instance",null);let u=d;const h=class h extends y{constructor(){super();n(this,"currentPlayerId");this.currentPlayerId=0}getNextTurn(){if(this.notify(this.currentPlayerId),this.subscribers.size===0)return;const e=u.getInstance().getPlayersNumber();if(e===0){this.unsubscribe(u.getInstance());return}this.currentPlayerId>=e-1?this.currentPlayerId=0:this.currentPlayerId+=1}static getInstance(){return this.instance||(this.instance=new h),this.instance}};n(h,"instance",null);let o=h;class I extends y{constructor(e,r){super();n(this,"name");n(this,"id");n(this,"diceResults");n(this,"winStatus");this.id=e,r==null?this.name=`Player ${e+1}`:this.name=r,this.diceResults=[],this.winStatus=!1,u.getInstance().subscribe(this)}update(e){this.diceResults.push(e.diceResult),this.winStatus=this.score>=21;const r={playerId:this.id,newDiceResult:e.diceResult,playerScore:this.score,isWinner:this.winStatus};this.notify(r),this.isWinner()&&u.getInstance().unsubscribe(this)}get score(){return this.diceResults.reduce((e,r)=>e+r,0)}getName(){return this.name}getId(){return this.id}isWinner(){return this.winStatus}}class w{constructor(){n(this,"players");this.players=[]}update(t){const e=this.players.reduce((m,b)=>m+b.score,0),r=document.querySelector(".main__dice-cap"),s=r.querySelector(".dice-cap__score");s.textContent=`Total score: ${e}`;const i=document.createElement("li");i.className="dice-cap__value",i.textContent=`${t.newDiceResult}`,r.querySelector(".dice-cap__values").appendChild(i);const a=document.querySelector(`#Player${t.playerId}`),f=a.querySelector(".player-field__score");f.textContent=`Player score: ${t.playerScore}`;const p=document.createElement("li");p.className="dice-cap__value",p.textContent=`${t.newDiceResult}`,a.querySelector(".player-field__dice-values").appendChild(p),t.isWinner&&a.classList.add("_winner")}addPlayerFields(){const t=document.querySelector(".main__fields");this.players.forEach((e,r)=>{const s=document.createElement("div");s.className="main__player-field player-field",s.id=`Player${r}`;const i=document.createElement("h2");i.className="player-field__header",i.textContent=e.getName(),s.appendChild(i);const l=document.createElement("ul");l.className="player-field__dice-values",s.appendChild(l);const a=document.createElement("div");a.className="player-field__score",a.textContent="Player score: 0",s.appendChild(a),t.appendChild(s)})}startGame(){for(let e=0;e<P;e++){const r=new I(e);this.players.push(r),r.subscribe(this)}this.addPlayerFields(),document.querySelector(".main__button").addEventListener("click",()=>{o.getInstance().getNextTurn()})}}const C=new w;C.startGame();
