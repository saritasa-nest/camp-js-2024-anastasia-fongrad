var p=Object.defineProperty;var y=(c,e,t)=>e in c?p(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var i=(c,e,t)=>y(c,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const a=2,f=6;class m{constructor(){i(this,"subscribers");this.subscribers=[]}subscribe(e){this.subscribers.push(e)}unsubscribe(e){const t=this.subscribers.indexOf(e);t!==-1&&this.subscribers.splice(t,1)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}}class _ extends m{constructor(){super();i(this,"currentPlayerId");this.currentPlayerId=a}getNextTurn(){const t=this.subscribers[0].getPlayersNumber();t!==0&&(this.currentPlayerId>=t-1?this.currentPlayerId=0:this.currentPlayerId+=1,this.notify(this.currentPlayerId))}}class S{constructor(e,t,n){i(this,"name");i(this,"id");i(this,"diceResults");i(this,"winStatus");i(this,"subscribers");i(this,"diceGenerator");this.id=e,n==null?this.name=`Player ${e+1}`:this.name=n,this.diceResults=[],this.subscribers=[],this.winStatus=!1,this.diceGenerator=t,this.diceGenerator.subscribe(this)}subscribe(e){this.subscribers.push(e)}unsubscribe(e){const t=this.subscribers.indexOf(e);t!==-1&&this.subscribers.splice(t,1)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}update(e){this.diceResults.push(e.diceResult),this.winStatus=this.getScore()>=21;const t={playerId:e.playerId,newDiceResult:e.diceResult,playerScore:this.getScore(),isWinner:this.winStatus};this.notify(t),this.isWinner()&&this.diceGenerator.unsubscribe(this)}getScore(){return this.diceResults.reduce((e,t)=>e+t,0)}getName(){return this.name}getId(){return this.id}isWinner(){return this.winStatus}}class P{constructor(e){i(this,"subscribers");i(this,"sidesCount");i(this,"turnGenerator");this.sidesCount=f,this.subscribers=[],this.turnGenerator=e,this.turnGenerator.subscribe(this)}update(e){const t={playerId:e,diceResult:this.generateDiceNumber()};this.notify(t)}subscribe(e){this.subscribers.push(e)}unsubscribe(e){const t=this.subscribers.indexOf(e);t!==-1&&this.subscribers.splice(t,1),this.subscribers.length===0&&this.turnGenerator.unsubscribe(this)}notify(e){this.subscribers[e.playerId].update(e)}generateDiceNumber(){return Math.floor(Math.random()*this.sidesCount)+1}getPlayersNumber(){return this.subscribers.length}}class C{constructor(){i(this,"players");i(this,"diceGenerator");i(this,"turnGenerator");this.players=[],this.turnGenerator=new _,this.diceGenerator=new P(this.turnGenerator)}update(e){const t=this.players.reduce((h,b)=>h+b.getScore(),0),n=document.querySelector(".main__dice-cap"),s=n.querySelector(".dice-cap__score");s.textContent=`Total score: ${t}`;const r=document.createElement("li");r.className="dice-cap__value",r.textContent=`${e.newDiceResult}`,n.querySelector(".dice-cap__values").appendChild(r);const l=document.querySelector(`#Player${e.playerId}`),d=l.querySelector(".player-field__score");d.textContent=`Player score: ${e.playerScore}`;const o=document.createElement("li");o.className="dice-cap__value",o.textContent=`${e.newDiceResult}`,l.querySelector(".player-field__dice-values").appendChild(o),e.isWinner&&l.classList.add("_winner")}addPlayerFields(){const e=document.querySelector(".main__fields");this.players.forEach((t,n)=>{const s=document.createElement("div");s.className="main__player-field player-field",s.id=`Player${n}`;const r=document.createElement("h2");r.className="player-field__header",r.textContent=t.getName(),s.appendChild(r);const u=document.createElement("ul");u.className="player-field__dice-values",s.appendChild(u);const l=document.createElement("div");l.className="player-field__score",l.textContent="Player score: 0",s.appendChild(l),e.appendChild(s)})}startGame(){for(let t=0;t<a;t++){const n=new S(t,this.diceGenerator);this.players.push(n),n.subscribe(this)}this.addPlayerFields(),document.querySelector(".main__button").addEventListener("click",()=>{this.turnGenerator.getNextTurn()})}}const E=new C;E.startGame();
