var b=Object.defineProperty;var y=(c,e,t)=>e in c?b(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var i=(c,e,t)=>y(c,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const o=2,f=6;class m{constructor(){i(this,"subscribers");i(this,"currentPlayerIndex");this.subscribers=[],this.currentPlayerIndex=o}subscribe(e){this.subscribers.push(e)}unsubscribe(e){const t=this.subscribers.indexOf(e);t!==-1&&this.subscribers.splice(t,1)}notify(e){this.subscribers[this.currentPlayerIndex].update(e)}getNextTurn(){this.subscribers.length!==0&&(this.currentPlayerIndex>=this.subscribers.length-1?this.currentPlayerIndex=0:this.currentPlayerIndex+=1,this.notify(this.currentPlayerIndex))}}class _{constructor(e,t){i(this,"subscribers");i(this,"sidesCount");i(this,"playerIndex");i(this,"turnGenerator");this.playerIndex=e,this.sidesCount=f,this.subscribers=[],this.turnGenerator=t,this.turnGenerator.subscribe(this)}update(e){const t={playerIndex:this.playerIndex,playerTurn:e,diceResult:this.generateDiceNumber()};this.notify(t)}subscribe(e){this.subscribers.push(e)}unsubscribe(e){const t=this.subscribers.indexOf(e);t!==-1&&this.subscribers.splice(t,1),this.subscribers.length===0&&this.turnGenerator.unsubscribe(this)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}generateDiceNumber(){return Math.floor(Math.random()*this.sidesCount)+1}}class x{constructor(e,t,n){i(this,"name");i(this,"diceResults");i(this,"winStatus");i(this,"subscribers");i(this,"diceGenerator");this.name=e,this.diceResults=[],this.subscribers=[],this.winStatus=!1,this.diceGenerator=new _(t,n),this.diceGenerator.subscribe(this)}subscribe(e){this.subscribers.push(e)}unsubscribe(e){const t=this.subscribers.indexOf(e);t!==-1&&this.subscribers.splice(t,1)}notify(e){this.subscribers.forEach(t=>{t.update(e)})}update(e){this.diceResults.push(e.diceResult),this.winStatus=this.getScore()>=21;const t={playerIndex:e.playerIndex,newDiceResult:e.diceResult,playerScore:this.getScore(),isWinner:this.winStatus};this.notify(t),this.isWinner()&&this.diceGenerator.unsubscribe(this)}getScore(){return this.diceResults.reduce((e,t)=>e+t,0)}getName(){return this.name}isWinner(){return this.winStatus}}class S{constructor(){i(this,"players");i(this,"turnGenerator");this.players=[],this.turnGenerator=new m}update(e){const t=this.players.reduce((h,p)=>h+p.getScore(),0),n=document.querySelector(".main__dice-cap"),s=n.querySelector(".dice-cap__header");s.textContent=`Dice cap - ${t}`;const r=document.createElement("li");r.className="dice-cap__value",r.textContent=`${e.newDiceResult}`,n.querySelector(".dice-cap__values").appendChild(r);const l=document.querySelector(`#Player${e.playerIndex}`),d=l.querySelector(".player-field__score");d.textContent=`Player score: ${e.playerScore}`;const u=document.createElement("li");u.className="dice-cap__value",u.textContent=`${e.newDiceResult}`,l.querySelector(".player-field__dice-values").appendChild(u),e.isWinner&&l.classList.add("_winner")}addPlayerFields(){const e=document.querySelector(".main__fields");this.players.forEach((t,n)=>{const s=document.createElement("div");s.className="main__player-field player-field",s.id=`Player${n}`;const r=document.createElement("h2");r.className="player-field__header",r.textContent=t.getName(),s.appendChild(r);const a=document.createElement("ul");a.className="player-field__dice-values",s.appendChild(a);const l=document.createElement("div");l.className="player-field__score",l.textContent="Player score: 0",s.appendChild(l),e.appendChild(s)})}createPlayers(){for(let e=0;e<o;e++){const t=`Player ${e+1}`,n=new x(t,e,this.turnGenerator);this.players.push(n),n.subscribe(this)}this.addPlayerFields()}startGame(){this.createPlayers(),document.querySelector(".main__button").addEventListener("click",()=>{this.turnGenerator.getNextTurn()})}}const P=new S;P.startGame();
