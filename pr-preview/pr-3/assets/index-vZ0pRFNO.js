var b=Object.defineProperty;var S=(c,t,e)=>t in c?b(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var n=(c,t,e)=>S(c,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const P=2,g=6;class y{constructor(){n(this,"subscribers");this.subscribers=new Set}subscribe(t){this.subscribers.add(t)}unsubscribe(t){this.subscribers.has(t)&&this.subscribers.delete(t)}notify(t){this.subscribers.forEach(e=>{e.update(t)})}}const d=class d extends y{constructor(){super();n(this,"_sidesCount");this._sidesCount=g,o.getInstance().subscribe(this)}update(e){const r={playerId:e,diceResult:this.generateDiceNumber()};this.notify(r)}notify(e){if(this.subscribers.size===0)return;let{playerId:r}=e,s;const i=l=>l.id===r;for(;s==null;)s=Array.from(this.subscribers).find(i),r++;s.update(e)}static getInstance(){return this._instance||(this._instance=new d),this._instance}generateDiceNumber(){return Math.floor(Math.random()*this._sidesCount)+1}getPlayersNumber(){return this.subscribers.size}};n(d,"_instance",null);let u=d;const h=class h extends y{constructor(){super();n(this,"_currentPlayerId");this._currentPlayerId=0}generateNextTurn(){if(this.notify(this._currentPlayerId),this.subscribers.size===0)return;const e=u.getInstance().getPlayersNumber();if(e===0){this.unsubscribe(u.getInstance());return}this._currentPlayerId>=e-1?this._currentPlayerId=0:this._currentPlayerId+=1}static getInstance(){return this._instance||(this._instance=new h),this._instance}};n(h,"_instance",null);let o=h;class w extends y{constructor(e,r){super();n(this,"_name");n(this,"_id");n(this,"_diceResults");n(this,"_winStatus");this._id=e,r==null?this._name=`Player ${e+1}`:this._name=r,this._diceResults=[],this._winStatus=!1,u.getInstance().subscribe(this)}update(e){this._diceResults.push(e.diceResult),this._winStatus=this.score>=21;const r={playerId:this._id,newDiceResult:e.diceResult,playerScore:this.score,isWinner:this._winStatus};this.notify(r),this._winStatus&&u.getInstance().unsubscribe(this)}get score(){return this._diceResults.reduce((e,r)=>e+r,0)}get name(){return this._name}get id(){return this._id}get winStatus(){return this._winStatus}}class I{constructor(){n(this,"players");this.players=[]}update(t){const e=this.players.reduce((f,m)=>f+m.score,0),r=document.querySelector(".main__dice-cap"),s=r.querySelector(".dice-cap__score");s.textContent=`Total score: ${e}`;const i=document.createElement("li");i.className="dice-cap__value",i.textContent=`${t.newDiceResult}`,r.querySelector(".dice-cap__values").appendChild(i);const a=document.querySelector(`#Player${t.playerId}`),_=a.querySelector(".player-field__score");_.textContent=`Player score: ${t.playerScore}`;const p=document.createElement("li");p.className="dice-cap__value",p.textContent=`${t.newDiceResult}`,a.querySelector(".player-field__dice-values").appendChild(p),t.isWinner&&a.classList.add("player-field_winner")}addPlayerFields(){const t=document.querySelector(".main__fields");this.players.forEach((e,r)=>{const s=document.createElement("div");s.className="main__player-field player-field",s.id=`Player${r}`;const i=document.createElement("h2");i.className="player-field__header",i.textContent=e.name,s.appendChild(i);const l=document.createElement("ul");l.className="player-field__dice-values",s.appendChild(l);const a=document.createElement("div");a.className="player-field__score",a.textContent="Player score: 0",s.appendChild(a),t.appendChild(s)})}startGame(){for(let e=0;e<P;e++){const r=new w(e);this.players.push(r),r.subscribe(this)}this.addPlayerFields(),document.querySelector(".main__button").addEventListener("click",()=>{o.getInstance().generateNextTurn()})}}const C=new I;C.startGame();
